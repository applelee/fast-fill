<html>
<head>
  <title>demo1</title>
</head>
<script src='/lib/FastFill.js'></script>
<body>
  <div class='color'>
    <span>当前色：</span>
    <div></div>
  </div>
  <div class='img'>
    <span img-url='/example/timg-small.jpg'>图1</span>
    <span img-url='/example/robot.png'>图2</span>
  </div>
  <div class='pan'>
    <span>选色：</span>
    <div class='gray' color-data='[100, 100, 100, 255]'></div>
    <div class='red' color-data='[170, 0, 0, 255]'></div>
    <div class='green' color-data='[0, 170, 0, 255]'></div>
    <div class='blue' color-data='[0, 0, 170, 255]'></div>
  </div>
  <div id='canvas'></div>
</body>
<style>
body{margin: 0;display: flex;align-items: center;justify-content: center;}
#canvas{width: 600px;height: 800px;background-color: #eee;}
.color{display: flex;align-items: center;position: absolute;left: 0;top: 0;}
.color div{width: 50px;height: 50px;background-color: rgb(170, 0, 0)}
.pan{position: absolute;right: 0;top: 0;height: 50px;display: flex;align-items: center;}
.gray, .red, .blue, .green{width: 50px;height: 50px;cursor: pointer;}
.gray{background-color: rgb(100, 100, 100)}
.red{background-color: rgb(170, 0, 0)}
.blue{background-color: rgb(0, 0, 170)}
.green{background-color: rgb(0, 170, 0)}
.img{position: absolute;top: 0;left: 50%;transform: translateX(-50%);display: flex;padding: 10px 0;}
.img span{padding: 0 10px;cursor: pointer;}
.img span:hover{text-decoration: underline;}
</style>
<script>
var doms = document.querySelectorAll('.pan div')
var domC = document.querySelector('.color div')
var domImg = document.querySelectorAll('.img span')
// var FF = new FastFill({
//   elementId: 'canvas',
//   imageURL: '/example/timg-small.jpg',
//   fillColor: [170, 0, 0, 255],
//   // tolerance: 120
// })
var date;

var FF = FastFill.create({
  elementId: 'canvas',
  imageURL: '/example/timg-small.jpg',
  fillColor: [170, 0, 0, 255],
  tolerance: 150,
})
// 资源加载完成
FF.loaded(() => {
  // 图片
  console.log('资源加载完毕')
})
// 开始填色
FF.start(() => {
  console.log('START')
  date = Date.now()
})
// 完成填色
FF.done(() => {
  console.log('END', `${(Date.now() - date) / 1000}秒`)
})

doms.forEach(dom => {
  dom.addEventListener('click', () => {
    const colorArr = JSON.parse(dom.getAttribute('color-data'))
    domC.style.backgroundColor = `rgb(${colorArr[0]}, ${colorArr[1]}, ${colorArr[2]})`
    FF.update({
      fillColor: colorArr
    })
  })
})

domImg.forEach(dom => {
  dom.addEventListener('click', () => {
    FF.update({
      imageURL: dom.getAttribute('img-url')
    })
  })
})
</script>
</html>
