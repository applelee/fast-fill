<html>
<head></head>
<body>
  <canvas id='canvas'></canvas>
</body>
<style>
body{
  margin: 0;
}
</style>
<script>
var cvs = document.getElementById("canvas");
var ctx = cvs.getContext("2d");
var imageObj = new Image()
var range = 3
var startX = 0
var startY = 0
var imgWidth = 0
var imgHeight = 0

cvs.width = window.innerWidth
cvs.height = window.innerHeight

// ctx.rect(10, 10, 30, 30);
// ctx.fill();

imageObj.src = './timg.jpeg'
imageObj.onload = function(e) {
  imgWidth = this.width
  imgHeight = this.height

  ctx.drawImage(this, 0, 0, imgWidth, imgHeight, 0, 0, imgWidth, imgHeight);
}

cvs.addEventListener('click', function(e) {
  var p = getEventPosition(e)
  var rect = createRect(p)

  if ((p.x < startX && startX > imgWidth + startX || p.y < startY && startY > imgHeight + startY)) {
    return
  }

  var imgData = ctx.getImageData(rect.x, rect.y, rect.width, rect.height).data

  console.log(imgData)
  ctx.rect(rect.x, rect.y, rect.width, rect.height);
  ctx.fill();
})

var getEventPosition = function(ev) {
  var x, y;
  if (ev.layerX || ev.layerX == 0) {
    x = ev.layerX;
    y = ev.layerY;
  } else if (ev.offsetX || ev.offsetX == 0) { // Opera
    x = ev.offsetX;
    y = ev.offsetY;
  }
  return {x: x, y: y};
}

var createRect = function(p) {
  var num = correctPoint()

  return {
    x: p.x - num,
    y: p.y - num,
    width: range,
    height: range,
  }
}

var correctPoint = function() {
  var even = range

  if (even%2 !== 0) {
    even -= 1
  }

  return even/2
}

// console.log(ctx.getImageData(10, 10, 3, 3));
</script>
</html>
